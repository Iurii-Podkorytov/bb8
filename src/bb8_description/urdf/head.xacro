<?xml version="1.0"?>
<robot xmlns:xacro="http://www.ros.org/wiki/xacro">

  <link name="head">
    <visual>
      <origin xyz="0 0 -0.26" rpy="0 0 0"/>
      <geometry>
        <mesh filename="file:///$(find bb8_description)/meshes/head.stl" scale="0.001 0.001 0.001"/>
      </geometry>
      <material name="white_transparent">
        <color rgba="1 1 1 0.2"/>
      </material>
    </visual>
    <collision>
      <origin xyz="0 0 -0.26" rpy="0 0 0"/>
      <geometry>
        <mesh filename="file:///$(find bb8_description)/meshes/head.stl" scale="0.001 0.001 0.001"/>
      </geometry>
    </collision>
    <inertial>
      <mass value="1.0"/>
      <inertia ixx="0.2" iyy="0.2" izz="0.2" ixy="0.0" ixz="0.0" iyz="0.0"/>
    </inertial>
  </link>

  <!-- Intermediate links for ball joint -->
  <link name="head_x_link">
    <inertial>
      <mass value="0.01"/>
      <inertia ixx="0.001" iyy="0.001" izz="0.001" ixy="0.0" ixz="0.0" iyz="0.0"/>
    </inertial>
  </link>

  <link name="head_y_link">
    <inertial>
      <mass value="0.01"/>
      <inertia ixx="0.001" iyy="0.001" izz="0.001" ixy="0.0" ixz="0.0" iyz="0.0"/>
    </inertial>
  </link>

  <!-- Revolute joints with limits for full ball joint motion -->
  <joint name="head_x_joint" type="revolute">
    <parent link="base_link"/>
    <child link="head_x_link"/>
    <origin xyz="0 0 0" rpy="0 0 0"/>
    <axis xyz="1 0 0"/>
    <limit lower="-${pi/9}" upper="${pi/9}" effort="10" velocity="1.0"/>
    <dynamics damping="0.1" friction="0.01"/>
  </joint>

  <joint name="head_y_joint" type="revolute">
    <parent link="head_x_link"/>
    <child link="head_y_link"/>
    <origin xyz="0 0 0" rpy="0 0 0"/>
    <axis xyz="0 1 0"/>
    <limit lower="-${pi/9}" upper="${pi/9}" effort="10" velocity="1.0"/>
    <dynamics damping="0.1" friction="0.01"/>
  </joint>

  <!-- Fixed joint to attach head to the final rotation link -->
  <joint name="head_attachment" type="fixed">
    <parent link="head_y_link"/>
    <child link="head"/>
    <origin xyz="0 0 0.26" rpy="0 0 0"/>
  </joint>

  <gazebo>
    <plugin name="gazebo_ros_joint_state_publisher" filename="libgazebo_ros_joint_state_publisher.so">
      <joint_name>head_x_joint</joint_name>
      <joint_name>head_y_joint</joint_name>
      <update_rate>100.0</update_rate>
    </plugin>
  </gazebo>

</robot>