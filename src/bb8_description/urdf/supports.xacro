<?xml version="1.0"?>
<robot xmlns:xacro="http://www.ros.org/wiki/xacro">

  <!-- Main supports container -->
  <link name="supports"/>

  <!-- Macro to create individual supports -->
  <xacro:macro name="spherical_support" params="prefix angle_1 angle_2">
    <!-- Virtual link for positioning -->
    <link name="${prefix}_virtual"/>

    <!-- Sphere link -->
    <link name="${prefix}_sphere">
      <visual>
        <geometry>
          <sphere radius="0.005"/>
        </geometry>
        <material name="black"/>
      </visual>
      <collision>
        <geometry>
          <sphere radius="0.005"/>
        </geometry>
      </collision>
      <inertial>
        <mass value="0.01"/>
        <inertia ixx="0.00001" iyy="0.00001" izz="0.00001" ixy="0" ixz="0" iyz="0"/>
      </inertial>
    </link>

    <!-- Joint hierarchy -->
    <joint name="${prefix}_virtual_joint" type="fixed">
      <parent link="supports"/>
      <child link="${prefix}_virtual"/>
      <origin xyz="0 0 0" rpy="0 ${angle_1} ${angle_2}"/>
    </joint>

    <joint name="${prefix}_sphere_joint" type="fixed">
      <parent link="${prefix}_virtual"/>
      <child link="${prefix}_sphere"/>
      <origin xyz="0.25 0 0" rpy="0 0 0"/>
    </joint>

    <!-- Physics properties -->
    <gazebo reference="${prefix}_sphere">
      <mu>0</mu>
      <mu2>0</mu2>
      <self_collide>true</self_collide>
      <surface>
        <contact>
          <ode>
            <min_depth>1</min_depth>  <!-- Minimum penetration depth for collision response -->
            <margin>1</margin>        <!-- Distance buffer for collision detection -->
          </ode>
          <stiffness>1e-10</stiffness>     <!-- Contact stiffness -->
          <damping>1e10</damping>         <!-- Contact damping -->
        </contact>
      </surface>
      <collide_without_contact>false</collide_without_contact>
    </gazebo>
  </xacro:macro>
  
  <xacro:spherical_support prefix="support1" angle_1="$(eval -pi/2)" angle_2="$(eval 0)"/>

  <!-- Connect supports to base -->
  <joint name="supports_joint" type="fixed">
    <parent link="sphere_center"/>
    <child link="supports"/>
    <origin xyz="0 0 0" rpy="0 0 0"/>
  </joint>

</robot>