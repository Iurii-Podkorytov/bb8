<?xml version="1.0" ?>
<!-- =================================================================================== -->
<!-- |    This document was autogenerated by xacro from src/bb8_description/urdf/bb8.urdf.xacro | -->
<!-- |    EDITING THIS FILE BY HAND IS NOT RECOMMENDED                                 | -->
<!-- =================================================================================== -->
<robot name="bb8">
  <!-- Radius of the outer sphere -->
  <!-- Materials -->
  <material name="blue">
    <color rgba="0 0 1 1"/>
  </material>
  <material name="black">
    <color rgba="0 0 0 1"/>
  </material>
  <material name="white">
    <color rgba="1 1 1 1"/>
  </material>
  <material name="gray">
    <color rgba="0.5 0.5 0.5 1"/>
  </material>
  <gazebo reference="base_link">
    <material>Gazebo/Blue</material>
  </gazebo>
  <gazebo reference="left_wheel">
    <material>Gazebo/Black</material>
  </gazebo>
  <gazebo reference="right_wheel">
    <material>Gazebo/Black</material>
  </gazebo>
  <gazebo reference="sphere_link">
    <material>Gazebo/White</material>
  </gazebo>
  <!-- Base Footprint -->
  <link name="base_footprint"/>
  <!-- Base Link -->
  <link name="base_link">
    <visual>
      <origin rpy="0 0 0" xyz="0 0 -0.1708"/>
      <geometry>
        <cylinder length="0.05" radius="0.09"/>
      </geometry>
      <material name="blue"/>
    </visual>
    <inertial>
      <origin rpy="0 0 0" xyz="0 0 -0.1708"/>
      <mass value="0.5"/>
      <inertia ixx="0.0011166666666666668" ixy="0.0" ixz="0.0" iyy="0.0011166666666666668" iyz="0.0" izz="0.002025"/>
    </inertial>
  </link>
  <!-- Counterweight -->
  <link name="counterweight">
    <visual>
      <geometry>
        <cylinder length="0.04" radius="0.07"/>
      </geometry>
      <material name="black"/>
    </visual>
    <inertial>
      <origin rpy="0 0 0" xyz="0 0 0"/>
      <mass value="1.0"/>
      <inertia ixx="0.0007583333333333335" ixy="0.0" ixz="0.0" iyy="0.0007583333333333335" iyz="0.0" izz="0.0012500000000000002"/>
    </inertial>
  </link>
  <!-- Left Wheel -->
  <link name="left_wheel">
    <visual>
      <origin rpy="0 1.5707963267948966 0" xyz="0 0 0"/>
      <geometry>
        <mesh filename="file:////home/yura/AMR_project/install/bb8_description/share/bb8_description/meshes/wheel.stl" scale="0.001 0.001 0.001"/>
      </geometry>
      <material name="black"/>
    </visual>
    <collision>
      <origin rpy="0 1.5707963267948966 0" xyz="0 0 0"/>
      <geometry>
        <mesh filename="file:////home/yura/AMR_project/install/bb8_description/share/bb8_description/meshes/wheel.stl" scale="0.001 0.001 0.001"/>
      </geometry>
    </collision>
    <inertial>
      <origin rpy="0 1.5707963267948966 0" xyz="0 0 0"/>
      <mass value="0.05"/>
      <inertia ixx="0.00011552000000000002" ixy="0.0" ixz="0.0" iyy="0.00011552000000000002" iyz="0.0" izz="0.00011552000000000002"/>
    </inertial>
  </link>
  <link name="wheel_connector">
    <visual>
      <geometry>
        <cylinder length="0.01" radius="0.01"/>
      </geometry>
      <material name="blue"/>
    </visual>
    <inertial>
      <origin rpy="0 0 0" xyz="0 0 0"/>
      <mass value="0.01"/>
      <inertia ixx="3.333333333333333e-07" ixy="0.0" ixz="0.0" iyy="3.333333333333333e-07" iyz="0.0" izz="5.000000000000001e-07"/>
    </inertial>
  </link>
  <!-- Right Wheel -->
  <link name="right_wheel">
    <visual>
      <origin rpy="0 1.5707963267948966 0" xyz="0 0 0"/>
      <geometry>
        <mesh filename="file:////home/yura/AMR_project/install/bb8_description/share/bb8_description/meshes/wheel.stl" scale="0.001 0.001 0.001"/>
      </geometry>
      <material name="black"/>
    </visual>
    <collision>
      <origin rpy="0 1.5707963267948966 0" xyz="0 0 0"/>
      <geometry>
        <mesh filename="file:////home/yura/AMR_project/install/bb8_description/share/bb8_description/meshes/wheel.stl" scale="0.001 0.001 0.001"/>
      </geometry>
    </collision>
    <inertial>
      <origin rpy="0 1.5707963267948966 0" xyz="0 0 0"/>
      <mass value="0.05"/>
      <inertia ixx="0.00011552000000000002" ixy="0.0" ixz="0.0" iyy="0.00011552000000000002" iyz="0.0" izz="0.00011552000000000002"/>
    </inertial>
  </link>
  <!-- Joints -->
  <joint name="base_joint" type="fixed">
    <parent link="base_footprint"/>
    <child link="base_link"/>
    <origin rpy="0 0 0" xyz="0 0 0"/>
  </joint>
  <joint name="wheel_connector_joint" type="fixed">
    <parent link="base_link"/>
    <child link="wheel_connector"/>
    <origin rpy="0 0 1.5707963267948966" xyz="0 0 0"/>
  </joint>
  <joint name="counterweight_joint" type="fixed">
    <parent link="base_link"/>
    <child link="counterweight"/>
    <origin rpy="0 0 0" xyz="0 0 -0.21"/>
  </joint>
  <joint name="left_wheel_joint" type="continuous">
    <parent link="wheel_connector"/>
    <child link="left_wheel"/>
    <origin rpy="0 0 0" xyz="0.17185 0 -0.1458"/>
    <axis xyz="1 0 0"/>
  </joint>
  <joint name="right_wheel_joint" type="continuous">
    <parent link="wheel_connector"/>
    <child link="right_wheel"/>
    <origin rpy="0 0 0" xyz="-0.17185 0 -0.1458"/>
    <axis xyz="1 0 0"/>
  </joint>
  <!-- Collision Tuning for Robot and Sphere -->
  <gazebo reference="left_wheel">
    <self_collide>true</self_collide>
    <surface>
      <contact>
        <collide_without_contact>false</collide_without_contact>
        <stiffness>1e6</stiffness>
        <damping>2e3</damping>
      </contact>
      <friction>
        <ode>
          <mu>1.0</mu>
          <mu2>1.0</mu2>
        </ode>
      </friction>
    </surface>
  </gazebo>
  <gazebo reference="right_wheel">
    <self_collide>true</self_collide>
    <surface>
      <contact>
        <collide_without_contact>false</collide_without_contact>
        <stiffness>1e6</stiffness>
        <damping>2e3</damping>
      </contact>
      <friction>
        <ode>
          <mu>1.0</mu>
          <mu2>1.0</mu2>
        </ode>
      </friction>
    </surface>
  </gazebo>
  <!-- Outer Sphere Link -->
  <link name="sphere_link">
    <visual>
      <geometry>
        <mesh filename="file:////home/yura/AMR_project/install/bb8_description/share/bb8_description/meshes/sphere.stl" scale="0.001 0.001 0.001"/>
      </geometry>
      <material name="white_transparent">
        <color rgba="1 1 1 0.2"/>
      </material>
    </visual>
    <collision>
      <geometry>
        <mesh filename="file:////home/yura/AMR_project/install/bb8_description/share/bb8_description/meshes/sphere.stl" scale="0.001 0.001 0.001"/>
      </geometry>
    </collision>
    <inertial>
      <mass value="0.5"/>
      <inertia ixx="0.2" ixy="0.0" ixz="0.0" iyy="0.2" iyz="0.0" izz="0.2"/>
    </inertial>
  </link>
  <!-- Joint to Connect Sphere and Hamster -->
  <joint name="sphere_joint" type="floating">
    <parent link="base_footprint"/>
    <child link="sphere_link"/>
    <origin rpy="0 0 0" xyz="0 0 0"/>
  </joint>
  <!-- <gazebo reference="sphere_link">
    <mu>0.5</mu>
    <mu2>0.5</mu2>
    <collision>
      <margin>0.01</margin>
    </collision>
  </gazebo> -->
  <gazebo reference="sphere_link">
    <mu>1.0</mu>
    <mu2>1.0</mu2>
    <collision>
      <surface>
        <contact>
          <ode>
            <min_depth>0.001</min_depth>
          </ode>
        </contact>
      </surface>
      <margin>0.01</margin>
    </collision>
  </gazebo>
  <!-- Main supports container -->
  <link name="supports"/>
  <!-- Virtual link for positioning -->
  <link name="support1_virtual"/>
  <!-- Sphere link -->
  <link name="support1_sphere">
    <visual>
      <geometry>
        <sphere radius="0.005"/>
      </geometry>
      <material name="black"/>
    </visual>
    <collision>
      <geometry>
        <sphere radius="0.005"/>
      </geometry>
    </collision>
    <inertial>
      <mass value="0.01"/>
      <inertia ixx="0.00001" ixy="0" ixz="0" iyy="0.00001" iyz="0" izz="0.00001"/>
    </inertial>
  </link>
  <!-- Joint hierarchy -->
  <joint name="support1_virtual_joint" type="fixed">
    <parent link="supports"/>
    <child link="support1_virtual"/>
    <origin rpy="0 0.7853981633974483 0" xyz="0 0 0"/>
  </joint>
  <joint name="support1_sphere_joint" type="fixed">
    <parent link="support1_virtual"/>
    <child link="support1_sphere"/>
    <origin rpy="0 0 0" xyz="0.2494 0 0"/>
  </joint>
  <!-- Physics properties -->
  <gazebo reference="support1_sphere">
    <mu>0.001</mu>
    <mu2>0.001</mu2>
    <self_collide>true</self_collide>
    <contact>
      <collide_without_contact>false</collide_without_contact>
      <stiffness>1e3</stiffness>
      <damping>10</damping>
    </contact>
  </gazebo>
  <!-- Virtual link for positioning -->
  <link name="support2_virtual"/>
  <!-- Sphere link -->
  <link name="support2_sphere">
    <visual>
      <geometry>
        <sphere radius="0.005"/>
      </geometry>
      <material name="black"/>
    </visual>
    <collision>
      <geometry>
        <sphere radius="0.005"/>
      </geometry>
    </collision>
    <inertial>
      <mass value="0.01"/>
      <inertia ixx="0.00001" ixy="0" ixz="0" iyy="0.00001" iyz="0" izz="0.00001"/>
    </inertial>
  </link>
  <!-- Joint hierarchy -->
  <joint name="support2_virtual_joint" type="fixed">
    <parent link="supports"/>
    <child link="support2_virtual"/>
    <origin rpy="0 0.7853981633974483 3.141592653589793" xyz="0 0 0"/>
  </joint>
  <joint name="support2_sphere_joint" type="fixed">
    <parent link="support2_virtual"/>
    <child link="support2_sphere"/>
    <origin rpy="0 0 0" xyz="0.2494 0 0"/>
  </joint>
  <!-- Physics properties -->
  <gazebo reference="support2_sphere">
    <mu>0.001</mu>
    <mu2>0.001</mu2>
    <self_collide>true</self_collide>
    <contact>
      <collide_without_contact>false</collide_without_contact>
      <stiffness>1e3</stiffness>
      <damping>10</damping>
    </contact>
  </gazebo>
  <!-- <xacro:spherical_support prefix="support1" angle_1="$(eval pi/4)" angle_2="$(eval pi/4)"/> -->
  <!-- <xacro:spherical_support prefix="support2" angle_1="$(eval pi/4)" angle_2="$(eval 3*pi/4)"/> -->
  <!-- <xacro:spherical_support prefix="support6" angle_1="$(eval pi/4)" angle_2="$(eval 5*pi/4)"/> -->
  <!-- <xacro:spherical_support prefix="support7" angle_1="$(eval pi/4)" angle_2="$(eval 7*pi/4)"/> -->
  <!-- Virtual link for positioning -->
  <link name="support3_virtual"/>
  <!-- Sphere link -->
  <link name="support3_sphere">
    <visual>
      <geometry>
        <sphere radius="0.005"/>
      </geometry>
      <material name="black"/>
    </visual>
    <collision>
      <geometry>
        <sphere radius="0.005"/>
      </geometry>
    </collision>
    <inertial>
      <mass value="0.01"/>
      <inertia ixx="0.00001" ixy="0" ixz="0" iyy="0.00001" iyz="0" izz="0.00001"/>
    </inertial>
  </link>
  <!-- Joint hierarchy -->
  <joint name="support3_virtual_joint" type="fixed">
    <parent link="supports"/>
    <child link="support3_virtual"/>
    <origin rpy="0 -1.0471975511965976 0" xyz="0 0 0"/>
  </joint>
  <joint name="support3_sphere_joint" type="fixed">
    <parent link="support3_virtual"/>
    <child link="support3_sphere"/>
    <origin rpy="0 0 0" xyz="0.2494 0 0"/>
  </joint>
  <!-- Physics properties -->
  <gazebo reference="support3_sphere">
    <mu>0.001</mu>
    <mu2>0.001</mu2>
    <self_collide>true</self_collide>
    <contact>
      <collide_without_contact>false</collide_without_contact>
      <stiffness>1e3</stiffness>
      <damping>10</damping>
    </contact>
  </gazebo>
  <!-- Virtual link for positioning -->
  <link name="support4_virtual"/>
  <!-- Sphere link -->
  <link name="support4_sphere">
    <visual>
      <geometry>
        <sphere radius="0.005"/>
      </geometry>
      <material name="black"/>
    </visual>
    <collision>
      <geometry>
        <sphere radius="0.005"/>
      </geometry>
    </collision>
    <inertial>
      <mass value="0.01"/>
      <inertia ixx="0.00001" ixy="0" ixz="0" iyy="0.00001" iyz="0" izz="0.00001"/>
    </inertial>
  </link>
  <!-- Joint hierarchy -->
  <joint name="support4_virtual_joint" type="fixed">
    <parent link="supports"/>
    <child link="support4_virtual"/>
    <origin rpy="0 -1.0471975511965976 2.0943951023931953" xyz="0 0 0"/>
  </joint>
  <joint name="support4_sphere_joint" type="fixed">
    <parent link="support4_virtual"/>
    <child link="support4_sphere"/>
    <origin rpy="0 0 0" xyz="0.2494 0 0"/>
  </joint>
  <!-- Physics properties -->
  <gazebo reference="support4_sphere">
    <mu>0.001</mu>
    <mu2>0.001</mu2>
    <self_collide>true</self_collide>
    <contact>
      <collide_without_contact>false</collide_without_contact>
      <stiffness>1e3</stiffness>
      <damping>10</damping>
    </contact>
  </gazebo>
  <!-- Virtual link for positioning -->
  <link name="support5_virtual"/>
  <!-- Sphere link -->
  <link name="support5_sphere">
    <visual>
      <geometry>
        <sphere radius="0.005"/>
      </geometry>
      <material name="black"/>
    </visual>
    <collision>
      <geometry>
        <sphere radius="0.005"/>
      </geometry>
    </collision>
    <inertial>
      <mass value="0.01"/>
      <inertia ixx="0.00001" ixy="0" ixz="0" iyy="0.00001" iyz="0" izz="0.00001"/>
    </inertial>
  </link>
  <!-- Joint hierarchy -->
  <joint name="support5_virtual_joint" type="fixed">
    <parent link="supports"/>
    <child link="support5_virtual"/>
    <origin rpy="0 -1.0471975511965976 4.1887902047863905" xyz="0 0 0"/>
  </joint>
  <joint name="support5_sphere_joint" type="fixed">
    <parent link="support5_virtual"/>
    <child link="support5_sphere"/>
    <origin rpy="0 0 0" xyz="0.2494 0 0"/>
  </joint>
  <!-- Physics properties -->
  <gazebo reference="support5_sphere">
    <mu>0.001</mu>
    <mu2>0.001</mu2>
    <self_collide>true</self_collide>
    <contact>
      <collide_without_contact>false</collide_without_contact>
      <stiffness>1e3</stiffness>
      <damping>10</damping>
    </contact>
  </gazebo>
  <!-- Connect supports to base -->
  <joint name="supports_joint" type="fixed">
    <parent link="base_link"/>
    <child link="supports"/>
    <origin rpy="0 0 0" xyz="0 0 0"/>
  </joint>
  <link name="head">
    <visual>
      <origin rpy="0 0 0" xyz="0 0 -0.26"/>
      <geometry>
        <mesh filename="file:////home/yura/AMR_project/install/bb8_description/share/bb8_description/meshes/head.stl" scale="0.001 0.001 0.001"/>
      </geometry>
      <material name="white_transparent">
        <color rgba="1 1 1 0.2"/>
      </material>
    </visual>
    <inertial>
      <origin rpy="0 0 0" xyz="0 0 0.045"/>
      <mass value="0.5"/>
      <inertia ixx="0.00375" ixy="0.0" ixz="0.0" iyy="0.00375" iyz="0.0" izz="0.005625"/>
    </inertial>
  </link>
  <!-- Intermediate links for ball joint -->
  <link name="head_x_link">
    <inertial>
      <mass value="0.01"/>
      <inertia ixx="0.001" ixy="0.0" ixz="0.0" iyy="0.001" iyz="0.0" izz="0.001"/>
    </inertial>
  </link>
  <link name="head_y_link">
    <inertial>
      <mass value="0.01"/>
      <inertia ixx="0.001" ixy="0.0" ixz="0.0" iyy="0.001" iyz="0.0" izz="0.001"/>
    </inertial>
  </link>
  <!-- Revolute joints with limits for full ball joint motion -->
  <joint name="head_x_joint" type="revolute">
    <parent link="base_link"/>
    <child link="head_x_link"/>
    <origin rpy="0 0 0" xyz="0 0 0"/>
    <axis xyz="1 0 0"/>
    <limit effort="10" lower="-0.3490658503988659" upper="0.3490658503988659" velocity="1.0"/>
    <dynamics damping="0.1" friction="0.01"/>
  </joint>
  <joint name="head_y_joint" type="revolute">
    <parent link="head_x_link"/>
    <child link="head_y_link"/>
    <origin rpy="0 0 0" xyz="0 0 0"/>
    <axis xyz="0 1 0"/>
    <limit effort="10" lower="-0.3490658503988659" upper="0.3490658503988659" velocity="1.0"/>
    <dynamics damping="0.1" friction="0.01"/>
  </joint>
  <!-- Fixed joint to attach head to the final rotation link -->
  <joint name="head_attachment" type="fixed">
    <parent link="head_y_link"/>
    <child link="head"/>
    <origin rpy="0 0 0" xyz="0 0 0.26"/>
  </joint>
  <gazebo>
    <plugin filename="libgazebo_ros_p3d.so" name="libgazebo_ros_p3d">
      <ros>
        <remapping>odom:=sphere_pose</remapping>
      </ros>
      <frame_name>base_footprint</frame_name>
      <body_name>sphere_link</body_name>
      <update_rate>50</update_rate>
      <gaussian_noise>0.01</gaussian_noise>
    </plugin>
  </gazebo>
  <ros2_control name="bb8" type="system">
    <hardware>
      <plugin>gazebo_ros2_control/GazeboSystem</plugin>
    </hardware>
    <joint name="left_wheel_joint">
      <command_interface name="velocity">
        <param name="min">-10</param>
        <param name="max">10</param>
      </command_interface>
      <state_interface name="velocity"/>
      <state_interface name="position"/>
    </joint>
    <joint name="right_wheel_joint">
      <command_interface name="velocity">
        <param name="min">-10</param>
        <param name="max">10</param>
      </command_interface>
      <state_interface name="velocity"/>
      <state_interface name="position"/>
    </joint>
    <joint name="head_x_joint">
      <command_interface name="position">
        <param name="min">-20</param>
        <param name="max">20</param>
      </command_interface>
      <state_interface name="position"/>
    </joint>
    <joint name="head_y_joint">
      <command_interface name="position">
        <param name="min">-20</param>
        <param name="max">20</param>
      </command_interface>
      <state_interface name="position"/>
    </joint>
  </ros2_control>
  <gazebo>
    <plugin filename="libgazebo_ros2_control.so" name="gazebo_ros2_control">
      <parameters>/home/yura/AMR_project/install/bb8_controllers/share/bb8_controllers/config/controllers.yaml</parameters>
    </plugin>
  </gazebo>
  <!-- IMU Link -->
  <link name="imu_base_link"/>
  <!-- IMU Joint -->
  <joint name="imu_base_joint" type="fixed">
    <parent link="base_link"/>
    <child link="imu_base_link"/>
    <origin rpy="0 0 0" xyz="0 0 0"/>
  </joint>
  <!-- Gazebo IMU Plugin -->
  <gazebo reference="imu_base_link">
    <sensor name="imu_base" type="imu">
      <always_on>true</always_on>
      <update_rate>50.0</update_rate>
      <visualize>true</visualize>
      <plugin filename="libgazebo_ros_imu_sensor.so" name="gazebo_ros_imu_base">
        <ros>
          <remapping>~/out:=imu_base</remapping>
        </ros>
        <frame_name>imu_base_link</frame_name>
        <enable_orientation>true</enable_orientation>
        <enable_angular_velocity>true</enable_angular_velocity>
        <enable_linear_acceleration>true</enable_linear_acceleration>
        <imu>
          <noise>
            <type>gaussian</type>
            <accel>
              <mean>0.0</mean>
              <stddev>0.01</stddev>
            </accel>
            <gyro>
              <mean>0.0</mean>
              <stddev>0.001</stddev>
            </gyro>
          </noise>
        </imu>
      </plugin>
    </sensor>
  </gazebo>
  <!-- IMU Link -->
  <link name="imu_head_link"/>
  <!-- IMU Joint -->
  <joint name="imu_head_joint" type="fixed">
    <parent link="head"/>
    <child link="imu_head_link"/>
    <origin rpy="0 0 0" xyz="0 0 0"/>
  </joint>
  <!-- Gazebo IMU Plugin -->
  <gazebo reference="imu_head_link">
    <sensor name="imu_head" type="imu">
      <always_on>true</always_on>
      <update_rate>50.0</update_rate>
      <visualize>true</visualize>
      <plugin filename="libgazebo_ros_imu_sensor.so" name="gazebo_ros_imu_head">
        <ros>
          <remapping>~/out:=imu_head</remapping>
        </ros>
        <frame_name>imu_head_link</frame_name>
        <enable_orientation>true</enable_orientation>
        <enable_angular_velocity>true</enable_angular_velocity>
        <enable_linear_acceleration>true</enable_linear_acceleration>
        <imu>
          <noise>
            <type>gaussian</type>
            <accel>
              <mean>0.0</mean>
              <stddev>0.01</stddev>
            </accel>
            <gyro>
              <mean>0.0</mean>
              <stddev>0.001</stddev>
            </gyro>
          </noise>
        </imu>
      </plugin>
    </sensor>
  </gazebo>
  <joint name="lidar_joint" type="fixed">
    <parent link="head"/>
    <child link="lidar"/>
    <origin rpy="0 0 0" xyz="0 0 0.15"/>
  </joint>
  <link name="lidar">
    <visual>
      <geometry>
        <cylinder length="0.04" radius="0.05"/>
      </geometry>
      <material name="black"/>
    </visual>
    <collision>
      <geometry>
        <cylinder length="0.04" radius="0.05"/>
      </geometry>
    </collision>
    <inertial>
      <mass value="0.1"/>
      <origin rpy="0 0 0" xyz="0 0 0"/>
      <inertia ixx="0.001" ixy="0" ixz="0" iyy="0.001" iyz="0" izz="0.001"/>
    </inertial>
  </link>
  <gazebo reference="lidar">
    <sensor name="lidar_sensor" type="ray">
      <pose>0 0 0 0 0 0</pose>
      <visualize>true</visualize>
      <update_rate>10.0</update_rate>
      <ray>
        <scan>
          <horizontal>
            <samples>360</samples>
            <resolution>1</resolution>
            <min_angle>-3.141592653589793</min_angle>
            <max_angle>3.141592653589793</max_angle>
          </horizontal>
        </scan>
        <range>
          <min>0.1</min>
          <max>12.0</max>
          <resolution>0.01</resolution>
        </range>
      </ray>
      <plugin filename="libgazebo_ros_ray_sensor.so" name="lidar_plugin">
        <ros>
          <remapping>~/out:=scan</remapping>
        </ros>
        <output_type>sensor_msgs/LaserScan</output_type>
        <frame_name>lidar</frame_name>
      </plugin>
    </sensor>
  </gazebo>
  <!-- <xacro:include filename="gazebo_control.xacro" /> -->
</robot>
